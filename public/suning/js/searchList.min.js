$(function(){console.log(1);mui(".mui-scroll-wrapper").scroll({scrollY:true,scrollX:false,startX:0,startY:0,indicators:false,deceleration:0.0006,bounce:true});var b=sn.getUrlParams().key||"";$("input").val(b);var a=1;loading();var c=function(i){var f=$.trim($("input").val());if(!f){mui.toast("请输入关键字");return false}var g=$("[data-order].cur").attr("data-order");var h=$("[data-order].cur").find("i").hasClass("down")?2:1;var d={};if(g){d[g]=h}var e=4;getProductListData($.extend({proName:f,page:a,pageSize:e},d),function(j){if(a==1){$(".productsList").html(template("productTpl",{model:j}))}else{$(".productsList").append(template("productTpl",{model:j}))}i&&i()})};c();$("input").on("keypress",function(h){var d=h.keyCode;var f=$(this).val();if(d=="13"){h.preventDefault();var g=$.trim($(this).val());if(!g){mui.toast("请输入关键字");return false}$("[data-order].cur").removeClass("cur").find("i").removeClass("top down");$(".productsList").html('<div class="loading"><span class="mui-icon mui-icon-spinner"></span></div>');a=1;c()}});$("[data-order]").on("tap",function(){$(".mui-scroll").css({transform:"translate3d(0px, 0px, 0px)"});var d=$(this);if(!d.hasClass("cur")){d.find("i").addClass("down");d.addClass("cur").siblings().removeClass("cur").find("i").removeClass("top down")}else{if(d.find("i").hasClass("top")){d.find("i").removeClass("top").addClass("down")}else{d.find("i").removeClass("down").addClass("top")}}loading();a=1;c()});mui.init({pullRefresh:{container:".mui-scroll-wrapper",contentnomore:"没有更多数据了",down:{callback:function(){var d=this;a=1;c(function(){d.endPulldownToRefresh()})}},up:{callback:function(){var d=this;setTimeout(function(){d.endPullupToRefresh()},200);a++;c(function(){console.log(1);d.endPullupToRefresh()})}}}})});var getProductListData=function(a,b){$.ajax({type:"get",url:"/api/product/queryProduct",data:a,dataType:"json",success:function(c){setTimeout(function(){if(c.data.length==0){mui.toast("没有更多商品了")}b&&b(c)},200)}})};var loading=function(){$(".productsList").html('<div class="loading"><span class="mui-icon mui-icon-spinner"></span></div>')};