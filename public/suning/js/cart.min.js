$(function(){$("img").lazyload({placeholder:"images/loading.gif",effect:"fadeIn",threshold:180});sn.getCartData(function(a){window.data=a.data;$(".content").html(template("cartTemplate",a));getNum();$("#all").on("click",function(){$(".cartBody").find("input").prop("checked",$(this).prop("checked"));getNum()});$(".cartBody").find("input").on("click",function(){getNum();var b=$(".cartBody").find("input").length;var c=$(".cartBody").find("input:checked").length;$("#all").prop("checked",b==c)});btnTap();$(".deleteBtn").on("tap",function(){var b=$(this).parents("li");var c=parseInt(b.attr("data-id"));deleteCart({id:c},function(d){console.log(d);if(d.success){b.remove()}else{mui.toast("删除失败，请重试")}})})})});var getItemById=function(a,c){var b=null;a.forEach(function(e,d){if(e.id==c){b=e}});return b};const upDateCart=function(a,b){sn.loginAjax({type:"post",url:"/api/cart/updateCart",data:a,dataType:"json",success:function(c){b&&b(c)},error:function(c){console.log(c)}})};var getCartData=function(a){sn.cartLoginAjax({type:"get",url:"/api/cart/queryCartPaging",data:{page:1,pageSize:100},dataType:"json",success:function(b){a&&a(b)},error:function(b){console.log(b)}})};const btnTap=function(){var a=_.debounce(function(){var b=parseInt($(this).siblings(".num").html());var c=$(this).parent().attr("data-id");if(b>1){console.log($(this));if($(this).hasClass("jia")){b++}if($(this).hasClass("jian")){b--}$(this).siblings(".num").html(b);upDateCart({id:c,size:1,num:b},function(d){})}else{$(this).parents("li").remove();deleteCart({id:c},function(d){console.log(d)})}getNum2()},300);$(".product .btn-size").on("tap",a)};const deleteCart=function(a,b){sn.loginAjax({type:"get",url:"/api/cart/deleteCart",data:a,dataType:"json",success:function(c){b&&b(c)},error:function(c){console.log(c)}})};var getNum=function(){var a=0;var c=$(".cartBody input:checked");for(var b=0;b<c.length;b++){var d=getItemById(window.data,$(c[b]).attr("data-id"));a+=d.price*d.num}$("#cartAmount").html(Math.ceil(a*100)/100)};var getNum2=function(){var a=0;var e=$(".product");for(var b=0;b<e.length;b++){var c=$(e[b]).find(".money").html();var d=$(e[b]).find(".num").html();a+=c*d}$("#cartAmount").html(a)};