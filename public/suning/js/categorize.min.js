$(function(){$("img").lazyload({placeholder:"images/loading.gif",effect:"fadeIn",threshold:180});mui(".mui-scroll-wrapper.left").scroll({deceleration:0.0005,indicators:false});mui(".mui-scroll-wrapper.right").scroll({deceleration:0.01,indicators:true});$(".search").on("tap",function(){location.href="search.html"});getFirstCate(function(d){$(".left ul").html(template("firstTemplate",d));var c=parseInt(window.sessionStorage.getItem("liId"));var a=c?c:d.rows[0].id;var b=($(".left ul li[data-id="+a+"]"));getSecondCate({id:a},function(e){$(".right .mui-scroll").html(template("secondTemplate",e));b.siblings().find("a").removeClass("now");b.find("a").addClass("now");$("img").lazyload({placeholder:"images/loading.gif",effect:"fadeIn",threshold:180});btnTap();buttonTap()});$(".left").on("tap","ul li",function(){scrollRight.scrollTo(0,0,100);window.sessionStorage.setItem("liId",$(this).data("id"));$(".left").find("li a").removeClass("now");$(this).find("a").addClass("now");getSecondCate({id:$(this).data("id")},function(e){$(".right .mui-scroll").html(template("secondTemplate",e));btnTap();buttonTap();$("img").lazyload({placeholder:"images/loading.gif",effect:"fadeIn",threshold:180})})})})});var scrollRight=mui(".right").scroll({indicators:false});const getFirstCate=function(a){$.ajax({type:"get",url:"/api/category/queryTopCategory",data:"",dataType:"json",success:function(b){a&&a(b)}})};const getSecondCate=function(a,b){$.ajax({type:"get",url:"/api/category/querySecondCategory",data:a,dataType:"json",success:function(c){b&&b(c)}})};const btnTap=function(){$(".product .btn-size").on("tap",function(){var c=$(this);if($(this).hasClass("jia")){var a=$(this).siblings(".num");var b=a.html();b++;a.html(b);if(b>0){$(this).siblings().css("visibility","visible");var d={size:1}}}if($(this).hasClass("jian")){var e=parseInt($(this).parent().attr("data-id"));var a=$(this).siblings(".num");var b=a.html();b--;a.html(b);if(b<=0){$(this).parent().find(".jia").siblings().css("visibility","hidden")}}})};const buttonTap=function(){$(".button").on("tap",function(){var b=$(this);var a=parseInt($(this).siblings(".num").html());var c=parseInt($(this).parent().attr("productId"));sn.getCartData(function(g){var f=b.parents(".product").find("img");var d=function(){};var e=$(".imgBox");objectFlyIn(f,e,d);AddcartOrUpdateCart(g,c,a)})})};function objectFlyIn(e,c,a){var g=c.offset();var d=e;var b=$('<img style="display: block;width: 50px;height: 50px;border-radius: 50px;position: fixed;z-index: 100000;" src="'+d.attr("src")+'">');var h,f;if(d.offset()){h=d.offset().left-$(window).scrollLeft();f=d.offset().top-$(window).scrollTop()}b.fly({start:{left:h+d.width()/2-25,top:f+d.height()/2-25},end:{left:g.left+10,top:g.top+10,width:10,height:10},onEnd:function(){this.destroy();a()}})}const btnElement=function(){sn.getCartData(function(f){var b=$(".product").find("[productId]");console.log(b);for(var e=0;e<b.length;e++){console.log(b[e].attr.productId);for(var d=0;d<f.data.length;d++){if(b[e].attr.productId==f.data[d]){console.log(1)}}}console.log(f);var a=f.data;var c=[];a.forEach(function(h,g){c[g]=h.productId})})};const upDateCart=function(a,b){sn.loginAjax({type:"post",url:"/api/cart/updateCart",data:a,dataType:"json",success:function(c){b&&b(c)},error:function(c){console.log(c)}})};const deleteCart=function(a,b){sn.loginAjax({type:"post",url:"/api/cart/deleteCart",data:a,dataType:"json",success:function(c){b&&b(c)},error:function(c){console.log(c)}})};const addCart=function(a,b){sn.loginAjax({type:"post",url:"/api/cart/addCart",data:a,success:function(c){b&&b(c)},error:function(){mui.toast("网络繁忙")}})};var AddcartOrUpdateCart=function(c,a,d){var e=c.data;if(!e){addCart({productId:a,size:1,num:d},function(j){if(j.success){mui.toast("添加购物车成功")}else{mui.toast("添加购物车失败")}});return false}var g=[];var f=[];e.forEach(function(k,j){g[e[j].id]=e[j].productId});e.forEach(function(k,j){f[j]=e[j].productId});if($.inArray(a,g)>0){var h=$.inArray(a,g);var i=c.data[$.inArray(a,f)].num;var b={id:h,size:1,num:i+d};upDateCart(b,function(j){mui.toast("购物车商品增加"+d+"件")})}else{addCart({productId:a,size:1,num:d},function(j){if(j.success){mui.toast("添加购物车成功")}})}};